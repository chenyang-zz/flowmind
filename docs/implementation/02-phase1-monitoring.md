# Phase 1: åŸºç¡€ç›‘æ§

**ç›®æ ‡**: å»ºç«‹ç³»ç»Ÿç›‘æ§èƒ½åŠ›ï¼Œæ•è·ç”¨æˆ·å…³é”®æ“ä½œ

**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

**é¢„è®¡æ—¶é—´**: 15 å¤©

---

## ğŸ“‹ æ¦‚è¿°

æœ¬é˜¶æ®µå®ç°äº† FlowMind çš„**åŸºç¡€ç›‘æ§ç³»ç»Ÿ**ï¼Œè¿™æ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ã€‚é€šè¿‡æ•è·ç”¨æˆ·çš„é”®ç›˜è¾“å…¥ã€å‰ªè´´æ¿å˜åŒ–å’Œåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸ºåç»­çš„æ¨¡å¼è¯†åˆ«å’Œ AI é©±åŠ¨çš„è‡ªåŠ¨åŒ–æä¾›äº†æ•°æ®æºã€‚

### æ ¸å¿ƒä»·å€¼

1. **å…¨é¢æ„ŸçŸ¥**: æ•è·ç”¨æˆ·çš„æ‰€æœ‰å…³é”®æ“ä½œï¼Œå½¢æˆå®Œæ•´çš„æ“ä½œæ—¥å¿—
2. **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: ä¸ä»…çŸ¥é“"åšäº†ä»€ä¹ˆ"ï¼Œè¿˜çŸ¥é“"åœ¨å“ªé‡Œåšçš„"
3. **äº‹ä»¶é©±åŠ¨**: åŸºäºå‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„äº‹ä»¶æ€»çº¿ï¼Œä¾¿äºæ‰©å±•å’Œé›†æˆ
4. **é«˜æ€§èƒ½**: ä½èµ„æºå ç”¨ï¼Œä¸å½±å“ç”¨æˆ·æ­£å¸¸ä½¿ç”¨

### å·²å®ŒæˆåŠŸèƒ½

- âœ… é”®ç›˜ç›‘æ§ï¼ˆåŒ…æ‹¬æ‰€æœ‰æŒ‰é”®å’Œä¿®é¥°é”®ï¼‰
- âœ… å‰ªè´´æ¿ç›‘æ§ï¼ˆå†…å®¹å˜åŒ–æ£€æµ‹ï¼‰
- âœ… åº”ç”¨ä¸Šä¸‹æ–‡è·å–ï¼ˆåº”ç”¨åç§°ã€Bundle IDã€çª—å£æ ‡é¢˜ï¼‰
- âœ… å¿«æ·é”®ç®¡ç†å’ŒåŒ¹é…
- âœ… äº‹ä»¶æ€»çº¿ç³»ç»Ÿï¼ˆå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼‰
- âœ… ç›‘æ§å¼•æ“ï¼ˆç»Ÿä¸€ç®¡ç†å’Œåè°ƒï¼‰

### å¾…å®ç°åŠŸèƒ½ï¼ˆåç»­é˜¶æ®µï¼‰

ä»¥ä¸‹åŠŸèƒ½å·²åœ¨æ¶æ„è®¾è®¡ä¸­å®šä¹‰ï¼Œä½†è®¡åˆ’åœ¨åç»­é˜¶æ®µå®ç°ï¼š

- â³ åº”ç”¨åˆ‡æ¢ç›‘æ§ï¼ˆäº‹ä»¶ç±»å‹å·²å®šä¹‰ï¼Œç›‘æ§å™¨å¾…å®ç°ï¼‰
- â³ æƒé™ç®¡ç†ç³»ç»Ÿï¼ˆè¾…åŠ©åŠŸèƒ½æƒé™æ£€æŸ¥å’Œæç¤ºï¼‰
- â³ æ€§èƒ½ä¼˜åŒ–ç»„ä»¶ï¼ˆäº‹ä»¶è¿‡æ»¤å™¨ã€æ‰¹é‡å¤„ç†å™¨ï¼‰
- â³ å‰ªè´´æ¿éšç§ä¿æŠ¤ï¼ˆè¯¦è§é˜¶æ®µ7ï¼‰

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Frontend (React 19 + Wails)                â”‚
â”‚                                                         â”‚
â”‚  - Dashboard: å®æ—¶æ˜¾ç¤ºç›‘æ§äº‹ä»¶                            â”‚
â”‚  - Settings: ç›‘æ§å™¨é…ç½®å’Œæƒé™ç®¡ç†                         â”‚
â”‚  - Automation Panel: å¿«æ·é”®è§¦å‘è‡ªåŠ¨åŒ–                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†‘ Wails Bindings
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Monitor Engine (ç›‘æ§å¼•æ“ - internal/monitor/)   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Keyboard Monitor (é”®ç›˜ç›‘æ§)                      â”‚ â”‚
â”‚  â”‚   â”œâ”€ å¹³å°å±‚: CGEventTap æ•è·æ‰€æœ‰é”®ç›˜è¾“å…¥           â”‚ â”‚
â”‚  â”‚   â”œâ”€ ä¸šåŠ¡å±‚: æ·»åŠ ä¸Šä¸‹æ–‡ï¼Œå‘å¸ƒåˆ°äº‹ä»¶æ€»çº¿            â”‚ â”‚
â”‚  â”‚   â””â”€ Hotkey Manager: å¿«æ·é”®åŒ¹é…å’Œè§¦å‘             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Clipboard Monitor (å‰ªè´´æ¿ç›‘æ§)                   â”‚ â”‚
â”‚  â”‚   â”œâ”€ å¹³å°å±‚: NSPasteboard è½®è¯¢æ£€æµ‹                â”‚ â”‚
â”‚  â”‚   â”œâ”€ ä¸šåŠ¡å±‚: åŒé‡å»é‡æœºåˆ¶                         â”‚ â”‚
â”‚  â”‚   â””â”€ 500ms æ£€æµ‹é—´éš”                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Context Manager (ä¸Šä¸‹æ–‡ç®¡ç†)                     â”‚ â”‚
â”‚  â”‚   â”œâ”€ NSWorkspace: åº”ç”¨åç§°å’Œ Bundle ID            â”‚ â”‚
â”‚  â”‚   â””â”€ Accessibility API: çª—å£æ ‡é¢˜                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ å‘å¸ƒäº‹ä»¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Event Bus (äº‹ä»¶æ€»çº¿ - pkg/events/)            â”‚
â”‚                                                         â”‚
â”‚  - å‘å¸ƒ-è®¢é˜…æ¨¡å¼                                         â”‚
â”‚  - é€šé…ç¬¦è®¢é˜…æ”¯æŒ                                        â”‚
â”‚  - å¼‚æ­¥äº‹ä»¶å¤„ç†                                          â”‚
â”‚  - ä¸­é—´ä»¶é“¾æ”¯æŒ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ è®¢é˜…äº‹ä»¶
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“           â†“          â†“           â†“          â†“
  Analyzer    Storage   Frontend    AI Service  Automation
  (Phase 2)   (Phase 2)    UI         (Phase 3)  (Phase 3)
```

### 2.2 åˆ†å±‚æ¶æ„è®¾è®¡

FlowMind é‡‡ç”¨**ä¸‰å±‚æ¶æ„**ï¼Œæ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£ï¼š

#### **å¹³å°å±‚** (`internal/platform/*_darwin.go`)

**èŒè´£**: ä¸æ“ä½œç³»ç»Ÿäº¤äº’ï¼Œè°ƒç”¨ç³»ç»Ÿ API

**å…³é”®å®ç°**:
- **CGO å°è£…**: ä½¿ç”¨ CGO è°ƒç”¨ macOS åŸç”Ÿ API
- **ç³»ç»Ÿäº‹ä»¶**: ä½¿ç”¨ Core Graphics Event Tap æ•è·é”®ç›˜äº‹ä»¶
- **å‰ªè´´æ¿ç›‘æ§**: ä½¿ç”¨ NSPasteboard API æ£€æµ‹å†…å®¹å˜åŒ–
- **ä¸Šä¸‹æ–‡è·å–**: ä½¿ç”¨ NSWorkspace å’Œ Accessibility API

**ä¼˜åŠ¿**:
- å¹³å°ç›¸å…³ä»£ç éš”ç¦»ï¼Œä¾¿äºè·¨å¹³å°æ‰©å±•
- åŸç”Ÿæ€§èƒ½ï¼Œæ— é¢å¤–å¼€é”€
- å®Œæ•´çš„ç³»ç»Ÿ API è®¿é—®èƒ½åŠ›

#### **ä¸šåŠ¡å±‚** (`internal/monitor/*.go`)

**èŒè´£**: é€»è¾‘å¤„ç†å’Œäº‹ä»¶å‘å¸ƒ

**å…³é”®åŠŸèƒ½**:
- **ä¸Šä¸‹æ–‡é›†æˆ**: ä¸ºæ¯ä¸ªäº‹ä»¶æ·»åŠ åº”ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯
- **äº‹ä»¶è½¬æ¢**: å°†å¹³å°å±‚åŸå§‹äº‹ä»¶è½¬æ¢ä¸ºä¸šåŠ¡äº‹ä»¶
- **å»é‡å¤„ç†**: é¿å…é‡å¤äº‹ä»¶è§¦å‘
- **å¿«æ·é”®ç®¡ç†**: æ³¨å†Œã€åŒ¹é…å’Œè§¦å‘å¿«æ·é”®

**è®¾è®¡æ¨¡å¼**:
- **æ¥å£æ¨¡å¼**: ç»Ÿä¸€çš„ `Monitor` æ¥å£
- **ç»„åˆæ¨¡å¼**: Engine ç®¡ç†å¤šä¸ªç›‘æ§å™¨
- **è§‚å¯Ÿè€…æ¨¡å¼**: é€šè¿‡äº‹ä»¶æ€»çº¿å‘å¸ƒäº‹ä»¶

#### **äº‹ä»¶æ€»çº¿** (`pkg/events/bus.go`)

**èŒè´£**: äº‹ä»¶åˆ†å‘å’Œè®¢é˜…ç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**:
- **å‘å¸ƒ-è®¢é˜…**: è§£è€¦äº‹ä»¶ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…
- **é€šé…ç¬¦è®¢é˜…**: ä½¿ç”¨ `*` è®¢é˜…æ‰€æœ‰äº‹ä»¶
- **å¼‚æ­¥å¤„ç†**: æ¯ä¸ªè®¢é˜…è€…ç‹¬ç«‹ goroutine å¤„ç†
- **ä¸­é—´ä»¶é“¾**: æ”¯æŒæ—¥å¿—ã€æ¢å¤ã€é™æµç­‰ä¸­é—´ä»¶

**ä¼˜åŠ¿**:
- æ¾è€¦åˆï¼Œæ˜“äºæ‰©å±•
- é«˜æ€§èƒ½ï¼Œæ”¯æŒé«˜å¹¶å‘
- ä¼˜é›…å…³é—­ï¼Œä¿è¯äº‹ä»¶å¤„ç†å®Œæˆ

### 2.3 æ•°æ®æµå‘å›¾

```
ç”¨æˆ·æ“ä½œ (æŒ‰ Cmd+C)
    â†“
macOS CoreGraphics
    â†“ (CGEventTap å›è°ƒ)
platform.KeyboardEvent {
    KeyCode: 8,
    Modifiers: 0x100000
}
    â†“ (ä¸šåŠ¡å±‚å¤„ç† - keyboard.go)
+ ContextProvider.GetContext() {
    Application: "Chrome",
    BundleID: "com.google.Chrome",
    WindowTitle: "FlowMind - Phase 1"
}
    â†“ (æ„é€ äº‹ä»¶)
events.Event {
    ID: "uuid-xxxx",
    Type: "keyboard",
    Timestamp: 2026-01-30 10:30:45,
    Data: {
        keycode: 8,
        modifiers: 0x100000
    },
    Context: {
        Application: "Chrome",
        BundleID: "com.google.Chrome",
        WindowTitle: "FlowMind - Phase 1"
    }
}
    â†“ (å‘å¸ƒåˆ°äº‹ä»¶æ€»çº¿)
EventBus.Publish("keyboard", event)
    â†“ (è®¢é˜…è€…æ¥æ”¶)
HotkeyManager.Match() â†’ åŒ¹é…æˆåŠŸ
    â†“ (è§¦å‘å›è°ƒ)
OpenAIPanel() â†’ å‰ç«¯å“åº”
```

### 2.4 ç»„ä»¶äº¤äº’æ—¶åºå›¾

```
ç”¨æˆ·     macOS     å¹³å°å±‚     ä¸šåŠ¡å±‚     ä¸Šä¸‹æ–‡ç®¡ç†    äº‹ä»¶æ€»çº¿    å…¶ä»–æ¨¡å—
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”‚
 â”œâ”€è¾“å…¥Cmd+Mâ”€â†’        â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚         â”œâ”€äº‹ä»¶æ•è·â”€â†’â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚         â”‚          â”œâ”€å›è°ƒâ”€â”€â”€â”€â†’â”‚            â”‚            â”‚           â”‚
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚         â”‚          â”‚          â”œâ”€è·å–ä¸Šä¸‹æ–‡â”€â”€â”¤            â”‚           â”‚
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚         â”‚          â”‚          â”‚<â”€â”€â”€â”€è¿”å›â”€â”€â”€â”€â”¤            â”‚           â”‚
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚         â”‚          â”‚          â”œâ”€æ„é€ äº‹ä»¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’           â”‚
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚         â”‚          â”‚          â”‚            â”œâ”€å‘å¸ƒâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”œâ”€è®¢é˜…å¤„ç†
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”œâ”€è§¦å‘åŠŸèƒ½
 â”‚         â”‚          â”‚          â”‚            â”‚            â”‚           â”‚
 â”‚â—€â”€UIå“åº”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶å®ç°

### 3.1 ç›‘æ§å¼•æ“ (Engine)

**æ–‡ä»¶**: `internal/monitor/engine.go`

#### èŒè´£

ç›‘æ§å¼•æ“æ˜¯æ•´ä¸ªç›‘æ§ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œè´Ÿè´£ï¼š
- ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç›‘æ§å™¨çš„ç”Ÿå‘½å‘¨æœŸ
- åè°ƒç›‘æ§å™¨çš„å¯åŠ¨å’Œåœæ­¢
- å‘å¸ƒç›‘æ§å¼•æ“çš„çŠ¶æ€äº‹ä»¶
- æä¾›ç»Ÿä¸€çš„è®¿é—®æ¥å£

#### æ ¸å¿ƒç»“æ„

```go
// Engine ç›‘æ§å¼•æ“ï¼Œç®¡ç†æ‰€æœ‰ç›‘æ§å™¨
type Engine struct {
    // keyboard é”®ç›˜ç›‘æ§å™¨å®ä¾‹
    keyboard Monitor

    // clipboard å‰ªè´´æ¿ç›‘æ§å™¨å®ä¾‹
    clipboard Monitor

    // eventBus äº‹ä»¶æ€»çº¿ï¼Œç”¨äºå‘å¸ƒå’Œè®¢é˜…äº‹ä»¶
    eventBus *events.EventBus

    // isRunning å¼•æ“è¿è¡ŒçŠ¶æ€æ ‡å¿—
    isRunning bool

    // mu è¯»å†™é”ï¼Œä¿æŠ¤å¹¶å‘è®¿é—®
    mu sync.RWMutex
}
```

#### å…³é”®ç‰¹æ€§

**1. çº¿ç¨‹å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†**

```go
// Start å¯åŠ¨ç›‘æ§å¼•æ“
func (e *Engine) Start() error {
    e.mu.Lock()
    defer e.mu.Unlock()

    if e.isRunning {
        return fmt.Errorf("monitor engine already running")
    }

    // åˆå§‹åŒ–å¹¶å¯åŠ¨é”®ç›˜ç›‘æ§å™¨
    e.keyboard = NewKeyboardMonitor(e.eventBus)
    if err := e.keyboard.Start(); err != nil {
        return fmt.Errorf("failed to start keyboard monitor: %w", err)
    }

    // åˆå§‹åŒ–å¹¶å¯åŠ¨å‰ªè´´æ¿ç›‘æ§å™¨
    e.clipboard = NewClipboardMonitor(e.eventBus)
    if err := e.clipboard.Start(); err != nil {
        // å‰ªè´´æ¿ç›‘æ§å™¨å¯åŠ¨å¤±è´¥ä¸å½±å“å¼•æ“å¯åŠ¨
        logger.Warn("å‰ªè´´æ¿ç›‘æ§å™¨å¯åŠ¨å¤±è´¥ï¼Œä½†å¼•æ“ç»§ç»­è¿è¡Œ")
    }

    e.isRunning = true

    // å‘å¸ƒçŠ¶æ€äº‹ä»¶
    statusEvent := events.NewEvent(events.EventTypeStatus, map[string]interface{}{
        "status":   "started",
        "monitors": []string{"keyboard", "clipboard"},
    })
    e.eventBus.Publish(string(events.EventTypeStatus), *statusEvent)

    return nil
}
```

**2. ä¼˜é›…çš„é”™è¯¯å¤„ç†**

- é”®ç›˜ç›‘æ§å™¨å¯åŠ¨å¤±è´¥ï¼šå¼•æ“å¯åŠ¨å¤±è´¥
- å‰ªè´´æ¿ç›‘æ§å™¨å¯åŠ¨å¤±è´¥ï¼šè®°å½•è­¦å‘Šï¼Œå¼•æ“ç»§ç»­è¿è¡Œ
- ä¿è¯éƒ¨åˆ†åŠŸèƒ½å¯ç”¨çš„æƒ…å†µä¸‹å°½é‡æä¾›å®Œæ•´æœåŠ¡

**3. çŠ¶æ€äº‹ä»¶å‘å¸ƒ**

```go
// å‘å¸ƒå¼•æ“å¯åŠ¨äº‹ä»¶
statusEvent := events.NewEvent(events.EventTypeStatus, map[string]interface{}{
    "status":   "started",
    "monitors": []string{"keyboard", "clipboard"},
})
e.eventBus.Publish(string(events.EventTypeStatus), *statusEvent)
```

#### ä½¿ç”¨ç¤ºä¾‹

```go
// åˆ›å»ºç›‘æ§å¼•æ“
eventBus := events.NewEventBus()
engine := monitor.NewEngine(eventBus)

// å¯åŠ¨å¼•æ“
if err := engine.Start(); err != nil {
    log.Fatal("å¯åŠ¨å¤±è´¥:", err)
}

// åœæ­¢å¼•æ“
defer engine.Stop()
```

---

### 3.2 é”®ç›˜ç›‘æ§

**æ–‡ä»¶**:
- `internal/monitor/keyboard.go` (ä¸šåŠ¡å±‚)
- `internal/platform/keyboard_darwin.go` (å¹³å°å±‚)

#### å¹³å°å±‚å®ç°

**æŠ€æœ¯æ ˆ**: Core Graphics Event Tap

```c
// CGO å›è°ƒå‡½æ•°
static CGEventRef callback(CGEventTapProxy proxy, CGEventType type,
                          CGEventRef event, void *refcon) {
    // åªå¤„ç†é”®ç›˜æŒ‰ä¸‹å’Œä¿®é¥°é”®å˜åŒ–äº‹ä»¶
    if (type == kCGEventKeyDown || type == kCGEventFlagsChanged) {
        // è·å–æŒ‰é”®ä»£ç 
        CGKeyCode keycode = (CGKeyCode)CGEventGetIntegerValueField(
            event, kCGKeyboardEventKeycode);

        // è·å–ä¿®é¥°é”®æ ‡å¿—ï¼ˆCommand, Shift, Control, Option ç­‰ï¼‰
        CGEventFlags flags = CGEventGetFlags(event);

        // å›è°ƒåˆ° Go å±‚å¤„ç†
        goKeyboardCallback((int)keycode, (int)flags);
    }

    return event;
}
```

**å…³é”®ç‚¹**:
- **äº‹ä»¶æ©ç **: åªç›‘å¬ `kCGEventKeyDown` å’Œ `kCGEventFlagsChanged`
- **ä¼šè¯çº§åˆ«**: `kCGSessionEventTap` - ç›‘å¬å½“å‰ç”¨æˆ·ä¼šè¯çš„æ‰€æœ‰äº‹ä»¶
- **äº‹ä»¶ä¼ é€’**: è¿”å›åŸå§‹äº‹ä»¶ï¼Œå…è®¸äº‹ä»¶ç»§ç»­ä¼ é€’åˆ°å…¶ä»–åº”ç”¨

**æƒé™è¦æ±‚**: âš ï¸ éœ€è¦è¾…åŠ©åŠŸèƒ½æƒé™

#### ä¸šåŠ¡å±‚å®ç°

```go
// KeyboardMonitor é”®ç›˜ç›‘æ§å™¨ï¼ˆä¸šåŠ¡å±‚ï¼‰
type KeyboardMonitor struct {
    // platform å¹³å°å±‚é”®ç›˜ç›‘æ§å™¨
    platform platform.KeyboardMonitor

    // eventBus äº‹ä»¶æ€»çº¿
    eventBus *events.EventBus

    // contextMgr ä¸Šä¸‹æ–‡ç®¡ç†å™¨
    contextMgr platform.ContextProvider

    // hotkeyManager å¿«æ·é”®ç®¡ç†å™¨
    hotkeyManager *HotkeyManager

    // isRunning ç›‘æ§å™¨è¿è¡ŒçŠ¶æ€æ ‡å¿—
    isRunning bool
}
```

**å·¥ä½œæµç¨‹**:

```go
// handlePlatformEvent å¤„ç†å¹³å°å±‚ä¼ æ¥çš„åŸå§‹é”®ç›˜äº‹ä»¶
func (km *KeyboardMonitor) handlePlatformEvent(event platform.KeyboardEvent) {
    // 1. è·å–ä¸Šä¸‹æ–‡
    context := km.contextMgr.GetContext()

    // 2. æ„é€ ä¸šåŠ¡äº‹ä»¶æ•°æ®
    data := map[string]interface{}{
        "keycode":   event.KeyCode,
        "modifiers": event.Modifiers,
    }

    // 3. åˆ›å»ºä¸šåŠ¡äº‹ä»¶
    businessEvent := events.NewEvent(events.EventTypeKeyboard, data)
    businessEvent.WithContext(context)

    // 4. å‘å¸ƒåˆ°äº‹ä»¶æ€»çº¿
    km.eventBus.Publish(string(events.EventTypeKeyboard), *businessEvent)
}
```

#### å¿«æ·é”®ç®¡ç†

**é¢„å®šä¹‰å¿«æ·é”®**:

```go
var presetHotkeys = []HotkeyConfig{
    {
        ID:          "ai.panel",
        KeyCode:     46, // M é”®
        Modifiers:   platform.ModifierCmd | platform.ModifierShift | platform.ModifierControl,
        Description: "æ‰“å¼€ AI é¢æ¿",
    },
}
```

**å¿«æ·é”®åŒ¹é…**:

```go
// matchModifiers åŒ¹é…ä¿®é¥°é”®ï¼ˆå¿½ç•¥ CapsLock ç­‰éå…³é”®ä¿®é¥°é”®ï¼‰
func (hm *HotkeyManager) matchModifiers(eventMods, targetMods uint64) bool {
    // æ¸…ç†æ ‡å¿—ä½ï¼Œåªä¿ç•™ Cmd/Shift/Control/Option
    eventClean := eventMods & 0xFFFFF
    targetClean := targetMods & 0xFFFFF
    return eventClean == targetClean
}
```

---

### 3.3 å‰ªè´´æ¿ç›‘æ§

**æ–‡ä»¶**:
- `internal/monitor/clipboard.go` (ä¸šåŠ¡å±‚)
- `internal/platform/clipboard_darwin.go` (å¹³å°å±‚)

#### å¹³å°å±‚å®ç°

**æŠ€æœ¯æ ˆ**: NSPasteboard API

```c
// getClipboardChangeCount è·å–å‰ªè´´æ¿å˜æ›´è®¡æ•°
long long getClipboardChangeCount() {
    NSPasteboard *pasteboard = [NSPasteboard generalPasteboard];
    if (pasteboard == nil) {
        return -1;
    }

    return [pasteboard changeCount];
}

// getClipboardContent è·å–å‰ªè´´æ¿å†…å®¹
char* getClipboardContent() {
    NSPasteboard *pasteboard = [NSPasteboard generalPasteboard];

    // æ£€æŸ¥æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²ç±»å‹
    NSString *type = [pasteboard availableTypeFromArray:@[NSPasteboardTypeString]];
    if (type == nil) {
        return NULL;
    }

    // è·å–å­—ç¬¦ä¸²å†…å®¹
    NSString *content = [pasteboard stringForType:NSPasteboardTypeString];
    if (content == nil) {
        return NULL;
    }

    // è½¬æ¢ä¸º C å­—ç¬¦ä¸²
    const char *cString = [content UTF8String];
    return strdup(cString);
}
```

**æ£€æµ‹æœºåˆ¶**:

```go
// DarwinClipboardMonitor macOS å¹³å°çš„å‰ªè´´æ¿ç›‘æ§å™¨å®ç°
type DarwinClipboardMonitor struct {
    // callback ç”¨æˆ·æ³¨å†Œçš„å‰ªè´´æ¿äº‹ä»¶å›è°ƒå‡½æ•°
    callback ClipboardCallback

    // lastChangeCount ä¸Šä¸€æ¬¡è®°å½•çš„å‰ªè´´æ¿å˜æ›´è®¡æ•°
    lastChangeCount int64

    // checkInterval æ£€æŸ¥é—´éš”ï¼ˆé»˜è®¤ 500msï¼‰
    checkInterval time.Duration
}

// run ç›‘æ§å¾ªç¯
func (m *DarwinClipboardMonitor) run() {
    ticker := time.NewTicker(m.checkInterval)
    defer ticker.Stop()

    for {
        select {
        case <-ticker.C:
            // æ£€æŸ¥ changeCount æ˜¯å¦å˜åŒ–
            currentChangeCount := C.getClipboardChangeCount()
            if m.lastChangeCount < currentChangeCount {
                m.lastChangeCount = currentChangeCount

                // è·å–æ–°å†…å®¹
                content := C.getClipboardContent()
                if content != nil {
                    defer C.freeString(content)

                    // è§¦å‘å›è°ƒ
                    m.callback(platform.ClipboardEvent{
                        Content: C.GoString(content),
                        Type:    "public.utf8-plain-text",
                        Size:    int64(len(C.GoString(content))),
                    })
                }
            }

        case <-m.stopChan:
            return
        }
    }
}
```

**ä¼˜åŠ¿**:
- âœ… æ— éœ€ç‰¹æ®Šæƒé™ï¼ˆä¸é”®ç›˜ç›‘æ§ä¸åŒï¼‰
- âœ… ä½ CPU å ç”¨ï¼ˆ500ms è½®è¯¢é—´éš”ï¼‰
- âœ… å¯é çš„æ£€æµ‹æœºåˆ¶ï¼ˆchangeCount ä¿è¯ï¼‰

#### ä¸šåŠ¡å±‚å®ç°

**åŒé‡å»é‡æœºåˆ¶**:

```go
// ClipboardMonitor å‰ªè´´æ¿ç›‘æ§å™¨ï¼ˆä¸šåŠ¡å±‚ï¼‰
type ClipboardMonitor struct {
    // platform å¹³å°å±‚å‰ªè´´æ¿ç›‘æ§å™¨
    platform platform.ClipboardMonitor

    // lastContent ä¸Šä¸€æ¬¡è®°å½•çš„å‰ªè´´æ¿å†…å®¹ï¼Œç”¨äºå»é‡
    lastContent string
}

// handlePlatformEvent å¤„ç†å¹³å°å±‚ä¼ æ¥çš„å‰ªè´´æ¿å˜åŒ–äº‹ä»¶
func (cm *ClipboardMonitor) handlePlatformEvent(event platform.ClipboardEvent) {
    // 1. æ£€æŸ¥å†…å®¹æ˜¯å¦ä¸ä¸Šæ¬¡ç›¸åŒï¼ˆä¸šåŠ¡å±‚å»é‡ï¼‰
    if event.Content == cm.lastContent {
        logger.Debug("å‰ªè´´æ¿å†…å®¹æœªå˜åŒ–ï¼Œå¿½ç•¥")
        return
    }

    cm.mu.Lock()
    cm.lastContent = event.Content
    cm.mu.Unlock()

    // è®°å½•æ—¥å¿—ï¼ˆæˆªå–å†…å®¹ä»¥é¿å…æ—¥å¿—è¿‡é•¿ï¼‰
    contentPreview := event.Content
    if len(contentPreview) > 100 {
        contentPreview = contentPreview[:100] + "..."
    }

    logger.Info("æ£€æµ‹åˆ°å‰ªè´´æ¿å†…å®¹å˜åŒ–",
        zap.String("type", event.Type),
        zap.Int64("size", event.Size),
        zap.String("preview", contentPreview),
    )

    // 2. è·å–ä¸Šä¸‹æ–‡
    context := cm.contextMgr.GetContext()

    // 3. æ„é€ ä¸šåŠ¡äº‹ä»¶
    data := map[string]interface{}{
        "content": event.Content,
        "type":    event.Type,
        "size":    event.Size,
        "length":  len(event.Content),
    }

    // 4. åˆ›å»ºå¹¶å‘å¸ƒäº‹ä»¶
    businessEvent := events.NewEvent(events.EventTypeClipboard, data)
    businessEvent.WithContext(context)
    cm.eventBus.Publish(string(events.EventTypeClipboard), *businessEvent)
}
```

**å»é‡æœºåˆ¶è¯´æ˜**:

1. **å¹³å°å±‚å»é‡**: é€šè¿‡ `changeCount` åˆ¤æ–­æ˜¯å¦çœŸçš„å‘ç”Ÿäº†å˜åŒ–
2. **ä¸šåŠ¡å±‚å»é‡**: é€šè¿‡å†…å®¹å¯¹æ¯”é˜²æ­¢é‡å¤è§¦å‘
3. **æ—¥å¿—ä¼˜åŒ–**: å†…å®¹é¢„è§ˆæˆªæ–­åˆ° 100 å­—ç¬¦

---

### 3.4 ä¸Šä¸‹æ–‡ç®¡ç†

**æ–‡ä»¶**: `internal/platform/context_darwin.go`

#### åŠŸèƒ½

ä¸ºæ¯ä¸ªç›‘æ§äº‹ä»¶æ·»åŠ ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- åº”ç”¨åç§°
- Bundle IDï¼ˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼‰
- çª—å£æ ‡é¢˜

#### å¹³å°å±‚å®ç°

**è·å–åº”ç”¨ä¿¡æ¯**:

```c
// getFrontmostAppName è·å–å½“å‰æœ€å‰ç«¯åº”ç”¨çš„æœ¬åœ°åŒ–åç§°
char* getFrontmostAppName() {
    NSRunningApplication *app = [NSWorkspace sharedWorkspace].frontmostApplication;
    if (app == nil) {
        return strdup("");
    }

    NSString *appName = [app localizedName];
    const char* cName = [appName UTF8String];
    return strdup(cName);
}

// getBundleID è·å–æœ€å‰ç«¯åº”ç”¨çš„ Bundle Identifier
char* getBundleID() {
    NSRunningApplication *app = [NSWorkspace sharedWorkspace].frontmostApplication;
    if (app == nil) {
        return strdup("");
    }

    NSString *bundleID = [app bundleIdentifier];
    const char* cBundleID = [bundleID UTF8String];
    return strdup(cBundleID);
}
```

**è·å–çª—å£æ ‡é¢˜**:

```c
// getFocusedWindowTitle è·å–å½“å‰ç„¦ç‚¹çª—å£çš„æ ‡é¢˜
char* getFocusedWindowTitle() {
    // è·å–æœ€å‰ç«¯åº”ç”¨
    NSRunningApplication *app = [NSWorkspace sharedWorkspace].frontmostApplication;

    // åˆ›å»ºåº”ç”¨çš„ AXUIElement
    AXUIElementRef appElement = AXUIElementCreateApplication([app processIdentifier]);

    // è·å–ç„¦ç‚¹çª—å£
    AXUIElementRef window = NULL;
    AXError err = AXUIElementCopyAttributeValue(appElement, kAXFocusedWindowAttribute, (CFTypeRef*)&window);

    // è·å–çª—å£æ ‡é¢˜
    CFStringRef title = NULL;
    err = AXUIElementCopyAttributeValue(window, kAXTitleAttribute, (CFTypeRef*)&title);

    // è½¬æ¢ä¸º C å­—ç¬¦ä¸²
    NSString *nsTitle = (__bridge NSString*)title;
    const char* cTitle = [nsTitle UTF8String];
    char* result = strdup(cTitle);

    // æ¸…ç†èµ„æº
    CFRelease(window);
    CFRelease(appElement);

    return result;
}
```

**æƒé™è¦æ±‚**: âš ï¸ çª—å£æ ‡é¢˜è·å–éœ€è¦è¾…åŠ©åŠŸèƒ½æƒé™

#### ä¸šåŠ¡å±‚ä½¿ç”¨

```go
// GetContext è·å–å®Œæ•´çš„åº”ç”¨ä¸Šä¸‹æ–‡
func (p *DarwinContextProvider) GetContext() *events.EventContext {
    return &events.EventContext{
        Application: p.getAppName(),
        BundleID:    p.getBundleID(),
        WindowTitle: p.getFocusedWindowTitle(),
    }
}
```

**äº‹ä»¶ä¸Šä¸‹æ–‡é›†æˆ**:

```go
// åˆ›å»ºäº‹ä»¶
event := events.NewEvent(events.EventTypeKeyboard, data)

// é™„åŠ ä¸Šä¸‹æ–‡
event.WithContext(contextMgr.GetContext())

// äº‹ä»¶ç°åœ¨åŒ…å«å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
// event.Context.Application
// event.Context.BundleID
// event.Context.WindowTitle
```

---

### 3.5 äº‹ä»¶æ€»çº¿

**æ–‡ä»¶**: `pkg/events/bus.go`

#### æ ¸å¿ƒåŠŸèƒ½

**å‘å¸ƒ-è®¢é˜…æ¨¡å¼**:

```go
// EventBus äº‹ä»¶æ€»çº¿
type EventBus struct {
    // subscribers è®¢é˜…è€…æ˜ å°„ï¼šäº‹ä»¶ç±»å‹ -> è®¢é˜…è€…åˆ—è¡¨
    subscribers map[string][]*Subscriber

    // middleware ä¸­é—´ä»¶é“¾
    middleware []Middleware

    // asyncEnabled æ˜¯å¦å¯ç”¨å¼‚æ­¥å‘å¸ƒ
    asyncEnabled bool
}
```

#### è®¢é˜…äº‹ä»¶

**1. åŸºç¡€è®¢é˜…**:

```go
// è®¢é˜…ç‰¹å®šç±»å‹çš„äº‹ä»¶
subscriberID := eventBus.Subscribe(string(events.EventTypeKeyboard), func(event events.Event) error {
    log.Printf("æ”¶åˆ°é”®ç›˜äº‹ä»¶: %+v", event)
    return nil
})
```

**2. é€šé…ç¬¦è®¢é˜…**:

```go
// è®¢é˜…æ‰€æœ‰äº‹ä»¶
subscriberID := eventBus.Subscribe("*", func(event events.Event) error {
    log.Printf("æ”¶åˆ°äº‹ä»¶: %s", event.Type)
    return nil
})
```

**3. å¸¦è¿‡æ»¤å™¨è®¢é˜…**:

```go
// åªå¤„ç†æ¥è‡ª Chrome çš„é”®ç›˜äº‹ä»¶
subscriberID := eventBus.SubscribeWithFilter(
    string(events.EventTypeKeyboard),
    func(event events.Event) error {
        // å¤„ç†äº‹ä»¶
        return nil
    },
    func(event events.Event) bool {
        // è¿‡æ»¤å™¨ï¼šåªå¤„ç† Chrome çš„äº‹ä»¶
        return event.Context.BundleID == "com.google.Chrome"
    },
)
```

**4. ä¸€æ¬¡æ€§è®¢é˜…**:

```go
// åªå¤„ç†ä¸€æ¬¡äº‹ä»¶
subscriberID := eventBus.SubscribeOnce(string(events.EventTypeStatus), func(event events.Event) error {
    log.Printf("å¼•æ“çŠ¶æ€: %v", event.Data)
    return nil
})
```

#### å‘å¸ƒäº‹ä»¶

**åŒæ­¥å‘å¸ƒ**:

```go
// ä¼šç­‰å¾…æ‰€æœ‰è®¢é˜…è€…å¤„ç†å®Œæˆ
err := eventBus.Publish(string(events.EventTypeKeyboard), *businessEvent)
```

**å¼‚æ­¥å‘å¸ƒ**:

```go
// ä¸ç­‰å¾…è®¢é˜…è€…å¤„ç†ï¼Œç«‹å³è¿”å›
eventBus.PublishAsync(string(events.EventTypeKeyboard), *businessEvent)
```

#### ä¸­é—´ä»¶æ”¯æŒ

**æ¢å¤ä¸­é—´ä»¶**:

```go
// é˜²æ­¢äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ panic å¯¼è‡´ç¨‹åºå´©æºƒ
eventBus.Use(events.RecoveryMiddleware())
```

**æ—¥å¿—ä¸­é—´ä»¶**:

```go
// è®°å½•æ‰€æœ‰äº‹ä»¶çš„å¤„ç†
eventBus.Use(events.LoggingMiddleware(func(event events.Event) {
    log.Printf("äº‹ä»¶å¤„ç†: %s", event.Type)
}))
```

**é™æµä¸­é—´ä»¶**:

```go
// é™åˆ¶æ¯ç§’æœ€å¤šå¤„ç† 100 ä¸ªäº‹ä»¶
eventBus.Use(events.RateLimitMiddleware(100))
```

#### ä¼˜é›…å…³é—­

```go
// åœæ­¢äº‹ä»¶æ€»çº¿ï¼Œç­‰å¾…æ‰€æœ‰æ­£åœ¨å¤„ç†çš„äº‹ä»¶å®Œæˆï¼ˆæœ€å¤šç­‰å¾… 30 ç§’ï¼‰
err := eventBus.Stop(30 * time.Second)
```

---

## ğŸš€ å®æ–½æ­¥éª¤æ€»ç»“

### Step 1: é¡¹ç›®åˆå§‹åŒ– âœ…

**ä»»åŠ¡æ¸…å•**:
- [x] Wails é¡¹ç›®æ­å»º
- [x] ç›®å½•ç»“æ„åˆ›å»º
- [x] ä¾èµ–é…ç½®ï¼ˆgo.modï¼‰

**ç›®å½•ç»“æ„**:

```
flowmind/
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ monitor/          # ä¸šåŠ¡å±‚ç›‘æ§å™¨
â”‚   â””â”€â”€ platform/         # å¹³å°å±‚å®ç°
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ events/           # äº‹ä»¶æ€»çº¿
â”‚   â””â”€â”€ logger/           # ç»“æ„åŒ–æ—¥å¿—
â”œâ”€â”€ frontend/             # Wails å‰ç«¯
â””â”€â”€ main.go               # Wails å…¥å£
```

**éªŒè¯æ ‡å‡†**:
- âœ… é¡¹ç›®å¯ä»¥æ­£å¸¸ç¼–è¯‘
- âœ… Wails å¼€å‘æœåŠ¡å™¨å¯ä»¥å¯åŠ¨

---

### Step 2: äº‹ä»¶ç³»ç»Ÿå®ç° âœ…

**æ–‡ä»¶**: `pkg/events/`

**æ ¸å¿ƒæ¥å£**:

```go
// Event ç»Ÿä¸€äº‹ä»¶ç»“æ„
type Event struct {
    ID        string                 // äº‹ä»¶å”¯ä¸€æ ‡è¯†
    Type      EventType              // äº‹ä»¶ç±»å‹
    Timestamp time.Time              // æ—¶é—´æˆ³
    Data      map[string]interface{} // äº‹ä»¶æ•°æ®
    Context   *EventContext          // ä¸Šä¸‹æ–‡ä¿¡æ¯
}

// EventContext äº‹ä»¶ä¸Šä¸‹æ–‡
type EventContext struct {
    Application string  // åº”ç”¨åç§°
    BundleID    string  // Bundle ID (macOS)
    WindowTitle string  // çª—å£æ ‡é¢˜
    FilePath    string  // æ–‡ä»¶è·¯å¾„
    Selection   string  // é€‰ä¸­æ–‡æœ¬
}

// EventType äº‹ä»¶ç±»å‹æšä¸¾
const (
    EventTypeKeyboard   EventType = "keyboard"    // é”®ç›˜äº‹ä»¶
    EventTypeClipboard  EventType = "clipboard"   // å‰ªè´´æ¿äº‹ä»¶
    EventTypeAppSwitch  EventType = "app_switch"  // åº”ç”¨åˆ‡æ¢ï¼ˆå¾…å®ç°ï¼‰
    EventTypeStatus     EventType = "status"      // çŠ¶æ€äº‹ä»¶
)
```

**éªŒè¯æ ‡å‡†**:
- âœ… æ”¯æŒå‘å¸ƒ-è®¢é˜…æ¨¡å¼
- âœ… é€šé…ç¬¦è®¢é˜…åŠŸèƒ½
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥90%

---

### Step 3: å¹³å°å±‚å®ç° âœ…

**æ–‡ä»¶**: `internal/platform/*_darwin.go`

**macOS ç‰¹å®šå®ç°**:

1. **é”®ç›˜ç›‘æ§**: CGEventTap
   - æ•è·æ‰€æœ‰é”®ç›˜è¾“å…¥
   - éœ€è¦è¾…åŠ©åŠŸèƒ½æƒé™

2. **å‰ªè´´æ¿**: NSPasteboard
   - 500ms è½®è¯¢æ£€æµ‹
   - æ— éœ€ç‰¹æ®Šæƒé™

3. **ä¸Šä¸‹æ–‡**: NSWorkspace + Accessibility
   - åº”ç”¨åç§°å’Œ Bundle ID
   - çª—å£æ ‡é¢˜éœ€è¦è¾…åŠ©åŠŸèƒ½æƒé™

**CGO å°è£…ç¤ºä¾‹**:

```go
/*
#cgo CFLAGS: -x objective-c
#cgo LDFLAGS: -framework CoreGraphics -framework Cocoa

#import <CoreGraphics/CoreGraphics.h>

// å£°æ˜ Go å›è°ƒå‡½æ•°
void goKeyboardCallback(int keyCode, int flags);
*/
import "C"

// CGEventTap å›è°ƒ
//export goKeyboardCallback
func goKeyboardCallback(keyCode C.int, flags C.int) {
    // å›è°ƒåˆ° Go å±‚
    callback(platform.KeyboardEvent{
        KeyCode:   int(keyCode),
        Modifiers: uint64(flags),
    })
}
```

**éªŒè¯æ ‡å‡†**:
- âœ… é”®ç›˜äº‹ä»¶æ•è·æˆåŠŸ
- âœ… å‰ªè´´æ¿å˜åŒ–æ£€æµ‹æˆåŠŸ
- âœ… åº”ç”¨ä¸Šä¸‹æ–‡è·å–æˆåŠŸ

---

### Step 4: ä¸šåŠ¡å±‚å®ç° âœ…

**æ–‡ä»¶**: `internal/monitor/*.go`

**ç›‘æ§å™¨æ¥å£**:

```go
// Monitor ç›‘æ§å™¨æ¥å£
//
// æ‰€æœ‰ç›‘æ§å™¨éƒ½å¿…é¡»å®ç°æ­¤æ¥å£ï¼Œæä¾›ç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
type Monitor interface {
    // Start å¯åŠ¨ç›‘æ§å™¨
    Start() error

    // Stop åœæ­¢ç›‘æ§å™¨
    Stop() error

    // IsRunning æ£€æŸ¥è¿è¡ŒçŠ¶æ€
    IsRunning() bool
}
```

**å®ç°è¦ç‚¹**:
- è®¢é˜…å¹³å°å±‚äº‹ä»¶
- æ·»åŠ åº”ç”¨ä¸Šä¸‹æ–‡
- å‘å¸ƒåˆ°äº‹ä»¶æ€»çº¿
- çº¿ç¨‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†

**éªŒè¯æ ‡å‡†**:
- âœ… æ‰€æœ‰ç›‘æ§å™¨ç‹¬ç«‹è¿è¡Œ
- âœ… äº‹ä»¶åŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡
- âœ… çº¿ç¨‹å®‰å…¨

---

### Step 5: ç›‘æ§å¼•æ“é›†æˆ âœ…

**æ–‡ä»¶**: `internal/monitor/engine.go`

**é›†æˆè¦ç‚¹**:
- ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç›‘æ§å™¨
- çº¿ç¨‹å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸ
- çŠ¶æ€äº‹ä»¶å‘å¸ƒ

**ä½¿ç”¨ç¤ºä¾‹**:

```go
// åˆ›å»ºç›‘æ§å¼•æ“
eventBus := events.NewEventBus()
engine := monitor.NewEngine(eventBus)

// å¯åŠ¨å¼•æ“
if err := engine.Start(); err != nil {
    log.Fatal("å¯åŠ¨å¤±è´¥:", err)
}

// åœæ­¢å¼•æ“
defer engine.Stop()
```

**éªŒè¯æ ‡å‡†**:
- âœ… å¼•æ“å¯åŠ¨æˆåŠŸ
- âœ… æ‰€æœ‰ç›‘æ§å™¨è¿è¡Œ
- âœ… äº‹ä»¶æ­£å¸¸å‘å¸ƒ

---

### Step 6: å¿«æ·é”®ç®¡ç† âœ…

**æ–‡ä»¶**: `internal/monitor/hotkey.go`

**åŠŸèƒ½**:
- å¿«æ·é”®æ³¨å†Œ
- ä¿®é¥°é”®çŠ¶æ€åŒ¹é…
- å›è°ƒå‡½æ•°è§¦å‘

**é¢„å®šä¹‰å¿«æ·é”®**:

```go
var presetHotkeys = []HotkeyConfig{
    {
        ID:          "ai.panel",
        KeyCode:     46, // M
        Modifiers:   platform.ModifierCmd | platform.ModifierShift | platform.ModifierControl,
        Description: "æ‰“å¼€ AI é¢æ¿",
    },
}
```

**éªŒè¯æ ‡å‡†**:
- âœ… å¿«æ·é”®æ³¨å†ŒæˆåŠŸ
- âœ… åŒ¹é…å‡†ç¡®
- âœ… å›è°ƒè§¦å‘æ­£å¸¸

---

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### æµ‹è¯•è¦†ç›–æƒ…å†µ

```
æ€»ä»£ç è¡Œæ•°: 5743 è¡Œ
æµ‹è¯•ä»£ç :   1769 è¡Œ (çº¦ 31%)

ç»„ä»¶æµ‹è¯•è¦†ç›–ç‡:
- Engine:         âœ… å®Œæ•´ (å¯åŠ¨ã€åœæ­¢ã€å¹¶å‘)
- Keyboard:       âœ… å®Œæ•´ (ç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶æµ)
- Clipboard:      âœ… å®Œæ•´ (13 ä¸ªæµ‹è¯•ç”¨ä¾‹)
- EventBus:       âœ… 90%+ è¦†ç›–ç‡
```

### å…³é”®æµ‹è¯•ç”¨ä¾‹

**å‰ªè´´æ¿ç›‘æ§æµ‹è¯•ç¤ºä¾‹**:

```go
// TestClipboardMonitor_Deduplication æµ‹è¯•å»é‡åŠŸèƒ½
func TestClipboardMonitor_Deduplication(t *testing.T) {
    // éªŒè¯é‡å¤å†…å®¹åªè§¦å‘ä¸€æ¬¡äº‹ä»¶
    monitor := NewClipboardMonitor(eventBus)

    eventCount := 0
    eventBus.Subscribe("clipboard", func(event events.Event) error {
        eventCount++
        return nil
    })

    // å‘é€é‡å¤å†…å®¹
    monitor.handlePlatformEvent(platform.ClipboardEvent{
        Content: "test",
        Type:    "public.utf8-plain-text",
    })
    monitor.handlePlatformEvent(platform.ClipboardEvent{
        Content: "test", // é‡å¤
        Type:    "public.utf8-plain-text",
    })

    // éªŒè¯åªè§¦å‘ä¸€æ¬¡
    assert.Equal(t, 1, eventCount)
}
```

### éªŒæ”¶æ ‡å‡†

- [x] é”®ç›˜äº‹ä»¶æ•è·å‡†ç¡®ç‡ 100%
- [x] å‰ªè´´æ¿å˜åŒ–æ£€æµ‹å»¶è¿Ÿ <500ms
- [x] åº”ç”¨ä¸Šä¸‹æ–‡è·å–æˆåŠŸç‡ >99%
- [x] å†…å­˜å ç”¨ <50MB
- [x] CPU ä½¿ç”¨ç‡ <5% (ç©ºé—²æ—¶)
- [x] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥80%

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å®æµ‹æ•°æ®

**ç›‘æ§å™¨æ€§èƒ½**:
```
- é”®ç›˜äº‹ä»¶: æ•è·å»¶è¿Ÿ <1ms
- å‰ªè´´æ¿æ£€æµ‹: 500ms è½®è¯¢é—´éš”
- ä¸Šä¸‹æ–‡è·å–: å¹³å‡ 10ms
```

**èµ„æºå ç”¨**:
```
- å†…å­˜: ~30MB (åŒ…å«æ‰€æœ‰ç›‘æ§å™¨)
- CPU: <2% (ç©ºé—²æ—¶)
- CPU: <5% (é«˜é¢‘è¾“å…¥æ—¶)
```

**äº‹ä»¶åå**:
```
- äº‹ä»¶å‘å¸ƒ: >10000 events/sec
- äº‹ä»¶è®¢é˜…: æ— æ˜æ˜¾å»¶è¿Ÿ
```

### ä¼˜åŒ–æªæ–½

1. **å¼‚æ­¥å¤„ç†**: æ¯ä¸ªè®¢é˜…è€…ç‹¬ç«‹ goroutine
2. **æ‰¹é‡å¤„ç†**: äº‹ä»¶æ‰¹é‡å†™å…¥ï¼ˆè®¡åˆ’ä¸­ï¼‰
3. **ç¼“å†²ä¼˜åŒ–**: å¯é…ç½®çš„ç¼“å†²åŒºå¤§å°
4. **å»é‡æœºåˆ¶**: å‡å°‘é‡å¤äº‹ä»¶å¤„ç†

---

## ğŸ”‘ å…³é”®æŠ€æœ¯ç‚¹

### 7.1 CGO äº‹ä»¶æ•è·

**æ ¸å¿ƒä»£ç **:

```go
/*
#cgo CFLAGS: -x objective-c
#cgo LDFLAGS: -framework CoreGraphics -framework AppKit
#import <CoreGraphics/CoreGraphics.h>
*/
import "C"

//export goKeyboardCallback
func goKeyboardCallback(keyCode C.int, flags C.int) {
    callback(platform.KeyboardEvent{
        KeyCode:   int(keyCode),
        Modifiers: uint64(flags),
    })
}
```

**å…³é”®ç‚¹**:
- `//export` å¯¼å‡º Go å‡½æ•°ä¾› C è°ƒç”¨
- `runtime.LockOSThread()` å›ºå®šçº¿ç¨‹
- CGO ç±»å‹è½¬æ¢: `C.int` â†” `int`

### 7.2 ä¿®é¥°é”®å¤„ç†

**ä¿®é¥°é”®æ ‡å¿—ä½**:

```go
const (
    ModifierCmd      uint64 = 1 << 20  // Command é”®
    ModifierShift    uint64 = 1 << 17  // Shift é”®
    ModifierControl  uint64 = 1 << 18  // Control é”®
    ModifierOption   uint64 = 1 << 19  // Option é”®
    ModifierCapsLock uint64 = 1 << 16  // CapsLock (éå…³é”®)
)
```

**åŒ¹é…æ—¶å¿½ç•¥éå…³é”®ä¿®é¥°é”®**:

```go
func (hm *HotkeyManager) matchModifiers(eventMods, targetMods uint64) bool {
    // æ¸…ç†æ ‡å¿—ä½ï¼Œåªä¿ç•™ Cmd/Shift/Control/Option
    eventClean := eventMods & 0xFFFFF
    targetClean := targetMods & 0xFFFFF
    return eventClean == targetClean
}
```

### 7.3 å»é‡æœºåˆ¶

**åŒé‡å»é‡**:

```go
// 1. å¹³å°å±‚: changeCount
if p.lastChangeCount < currentChangeCount {
    p.lastChangeCount = currentChangeCount
    // è§¦å‘å›è°ƒ
}

// 2. ä¸šåŠ¡å±‚: å†…å®¹å¯¹æ¯”
if event.Content == cm.lastContent {
    return // å¿½ç•¥é‡å¤
}
cm.lastContent = event.Content
```

**ä¼˜åŠ¿**:
- å¹³å°å±‚: é¿å…ä¸å¿…è¦çš„ç³»ç»Ÿè°ƒç”¨
- ä¸šåŠ¡å±‚: é˜²æ­¢å†…å®¹ç›¸åŒä½† changeCount å˜åŒ–çš„æƒ…å†µ

---

## ğŸ› ï¸ é‡åˆ°çš„æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆ

### æŒ‘æˆ˜ 1: CGO å›è°ƒå´©æºƒ

**é—®é¢˜**: C å›è°ƒä¸­è°ƒç”¨ Go å‡½æ•°å¯¼è‡´å´©æºƒ

**åŸå› **: Go çš„ goroutine è°ƒåº¦å™¨ä¸ C çº¿ç¨‹ä¸å…¼å®¹

**è§£å†³**: ä½¿ç”¨ `runtime.LockOSThread()` å›ºå®šçº¿ç¨‹

```go
func run() {
    // å›ºå®šåˆ°å½“å‰ OS çº¿ç¨‹
    runtime.LockOSThread()
    defer runtime.UnlockOSThread()

    // è¿è¡Œ CFRunLoop
    for {
        CFRunLoopRunInMode(kCFRunLoopDefaultMode, 0.1, false)
        if stopped {
            break
        }
    }
}
```

---

### æŒ‘æˆ˜ 2: ä¿®é¥°é”®çŠ¶æ€ä½

**é—®é¢˜**: CapsLock ç­‰éå…³é”®ä¿®é¥°é”®å¹²æ‰°åŒ¹é…

**ç°è±¡**:
- ç”¨æˆ·æŒ‰ä¸‹ `Cmd+M`
- ä½†å¦‚æœ CapsLock å¼€å¯ï¼Œä¿®é¥°é”®æ˜¯ `Cmd+CapsLock+M`
- å¯¼è‡´åŒ¹é…å¤±è´¥

**è§£å†³**: æ¸…ç†æ ‡å¿—ä½ï¼Œåªä¿ç•™å…³é”®ä¿®é¥°é”®

```go
func (hm *HotkeyManager) matchModifiers(eventMods, targetMods uint64) bool {
    // ä½¿ç”¨æ©ç æ¸…ç†éå…³é”®ä¿®é¥°é”®
    // 0xFFFFF ä¿ç•™: Cmd, Shift, Control, Option
    // å¿½ç•¥: CapsLock (1<<16), NumLock ç­‰
    eventClean := eventMods & 0xFFFFF
    targetClean := targetMods & 0xFFFFF
    return eventClean == targetClean
}
```

---

### æŒ‘æˆ˜ 3: å‰ªè´´æ¿é‡å¤è§¦å‘

**é—®é¢˜**: ç›¸åŒå†…å®¹å¤šæ¬¡è§¦å‘äº‹ä»¶

**åŸå› **:
- `changeCount` å˜åŒ–ä½†å†…å®¹ç›¸åŒï¼ˆåº”ç”¨å¤åˆ¶äº†å¤šæ¬¡ç›¸åŒå†…å®¹ï¼‰

**è§£å†³**: åŒé‡å»é‡æœºåˆ¶

1. **å¹³å°å±‚**: ä½¿ç”¨ `changeCount` ä½œä¸ºç¬¬ä¸€é“é˜²çº¿
2. **ä¸šåŠ¡å±‚**: å†…å®¹å¯¹æ¯”ä½œä¸ºç¬¬äºŒé“é˜²çº¿

```go
// å¹³å°å±‚å»é‡
if m.lastChangeCount < currentChangeCount {
    m.lastChangeCount = currentChangeCount
    // è§¦å‘å›è°ƒ
}

// ä¸šåŠ¡å±‚å»é‡
if event.Content == cm.lastContent {
    return // å¿½ç•¥é‡å¤
}
cm.lastContent = event.Content
```

---

## ğŸ”® å¾…å®ç°åŠŸèƒ½è¯¦è§£

è™½ç„¶è¿™äº›åŠŸèƒ½åœ¨æ¶æ„æ–‡æ¡£ä¸­å·²æœ‰è¯¦ç»†è®¾è®¡ï¼Œä½†è®¡åˆ’åœ¨åç»­é˜¶æ®µå®ç°ã€‚ä»¥ä¸‹ä¸ºç®€è¦è¯´æ˜ï¼š

### 1. åº”ç”¨åˆ‡æ¢ç›‘æ§

**äº‹ä»¶ç±»å‹**: `EventTypeAppSwitch` (å·²å®šä¹‰)

**åŠŸèƒ½æè¿°**:
- æ£€æµ‹å½“å‰æ´»åŠ¨åº”ç”¨çš„å˜åŒ–
- è®°å½•åº”ç”¨åˆ‡æ¢äº‹ä»¶ï¼ˆä»å“ªä¸ªåº”ç”¨åˆ‡æ¢åˆ°å“ªä¸ªåº”ç”¨ï¼‰
- ç»Ÿè®¡åº”ç”¨ä½¿ç”¨æ—¶é•¿ï¼ˆåº”ç”¨ä¼šè¯ï¼‰
- å‘å¸ƒ `EventTypeAppSession` äº‹ä»¶

**æ ¸å¿ƒç»„ä»¶**:
```go
// è®¡åˆ’å®ç°çš„ç»„ä»¶
- internal/domain/monitor/application.go  (åº”ç”¨åˆ‡æ¢ç›‘æ§å™¨)
- internal/domain/monitor/app_tracker.go   (åº”ç”¨ä¼šè¯è¿½è¸ªå™¨)
```

**å®ç°è¦ç‚¹**:
- è½®è¯¢æ£€æµ‹å‰ç«¯åº”ç”¨å˜åŒ–ï¼ˆ1ç§’é—´éš”ï¼‰
- è®°å½•åº”ç”¨åˆ‡æ¢å†å²
- ç»Ÿè®¡åº”ç”¨ä½¿ç”¨æ—¶é•¿
- å‘å¸ƒåº”ç”¨ä¼šè¯äº‹ä»¶

**é¢„è®¡å®ç°é˜¶æ®µ**: Phase 2

---

### 2. æƒé™ç®¡ç†ç³»ç»Ÿ

**äº‹ä»¶ç±»å‹**: `EventTypePermission` (å·²å®šä¹‰)

**åŠŸèƒ½æè¿°**:
- æ£€æŸ¥è¾…åŠ©åŠŸèƒ½æƒé™
- åœ¨æƒé™ç¼ºå¤±æ—¶æç¤ºç”¨æˆ·
- æä¾›æ‰“å¼€ç³»ç»Ÿè®¾ç½®çš„å¿«æ·æ–¹å¼
- ç›‘æ§å™¨å¯åŠ¨å‰çš„æƒé™éªŒè¯

**æ ¸å¿ƒåŠŸèƒ½**:
```go
// è®¡åˆ’å®ç°çš„åŠŸèƒ½
func CheckAccessibilityPermission() bool
func CheckClipboardPermission() bool
func PromptUserForPermission(permissionType string) error
```

**å®ç°è¦ç‚¹**:
- ä½¿ç”¨ `robotgo` æˆ–åŸç”Ÿ API æ£€æŸ¥æƒé™çŠ¶æ€
- å‹å¥½çš„æƒé™æç¤ºå¯¹è¯æ¡†
- ä¸€é”®æ‰“å¼€ç³»ç»Ÿè®¾ç½®é¢æ¿
- æƒé™å˜åŒ–ç›‘å¬

**é¢„è®¡å®ç°é˜¶æ®µ**: Phase 2

---

### 3. æ€§èƒ½ä¼˜åŒ–ç»„ä»¶

#### 3.1 äº‹ä»¶è¿‡æ»¤å™¨ (EventFilter)

**åŠŸèƒ½æè¿°**:
- è¿‡æ»¤è¿‡äºé¢‘ç¹çš„äº‹ä»¶
- é˜²æ­¢äº‹ä»¶é£æš´
- å¯é…ç½®çš„æœ€å°é—´éš”æ—¶é—´

**ä½¿ç”¨åœºæ™¯**:
```go
// ç¤ºä¾‹ï¼šé˜²æ­¢é”®ç›˜äº‹ä»¶è¿‡äºé¢‘ç¹
filter := NewEventFilter(100 * time.Millisecond)
if !filter.ShouldPass(event) {
    return // å¿½ç•¥äº‹ä»¶
}
```

**å®ç°è¦ç‚¹**:
- æŒ‰äº‹ä»¶ç±»å‹ + åº”ç”¨åç§°è¿›è¡Œåˆ†ç»„
- è®°å½•æ¯ç»„æœ€åä¸€æ¬¡äº‹ä»¶æ—¶é—´
- å¯é…ç½®çš„æœ€å°é—´éš”

#### 3.2 æ‰¹é‡å¤„ç†å™¨ (EventBatcher)

**åŠŸèƒ½æè¿°**:
- æ‰¹é‡æ”¶é›†äº‹ä»¶
- è¾¾åˆ°æ‰¹æ¬¡å¤§å°æˆ–è¶…æ—¶åç»Ÿä¸€å¤„ç†
- å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°

**ä½¿ç”¨åœºæ™¯**:
```go
// ç¤ºä¾‹ï¼šæ‰¹é‡å†™å…¥æ•°æ®åº“
batcher := NewEventBatcher(100, 1*time.Second, dbWriter)
batcher.Add(event)
```

**å®ç°è¦ç‚¹**:
- å¯é…ç½®çš„æ‰¹æ¬¡å¤§å°
- å¯é…ç½®çš„è¶…æ—¶æ—¶é—´
- ä¼˜é›…å…³é—­ï¼ˆåˆ·æ–°å‰©ä½™äº‹ä»¶ï¼‰

**é¢„è®¡å®ç°é˜¶æ®µ**: Phase 3ï¼ˆæ€§èƒ½ä¼˜åŒ–é˜¶æ®µï¼‰

---

### 4. å‰ªè´´æ¿éšç§ä¿æŠ¤

**åŠŸèƒ½æè¿°**:
- è¿‡æ»¤æ•æ„Ÿåº”ç”¨ï¼ˆå¯†ç ç®¡ç†å™¨ï¼‰
- æ£€æµ‹æ•æ„Ÿå†…å®¹æ¨¡å¼ï¼ˆå¯†ç ã€ä¿¡ç”¨å¡å·ï¼‰
- é™åˆ¶è®°å½•çš„å†…å®¹é•¿åº¦
- ç”¨æˆ·å¯é…ç½®çš„è¿‡æ»¤è§„åˆ™

**æ ¸å¿ƒç»„ä»¶**:
```go
// è®¡åˆ’åœ¨é˜¶æ®µ7å®ç°
type ClipboardFilter struct {
    sensitivePatterns []string
    ignoredApps       []string
    maxLength         int
}

func (cf *ClipboardFilter) ShouldRecord(content string, app string) bool
```

**å®ç°è¦ç‚¹**:
- æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ•æ„Ÿå†…å®¹
- åº”ç”¨é»‘åå•/ç™½åå•
- å†…å®¹é•¿åº¦é™åˆ¶ï¼ˆå¦‚ 10KBï¼‰
- ç”¨æˆ·å¯é…ç½®è§„åˆ™

**é¢„è®¡å®ç°é˜¶æ®µ**: Phase 7ï¼ˆéšç§ä¸å®‰å…¨é˜¶æ®µï¼‰

---

### 5. æ–‡ä»¶ç³»ç»Ÿç›‘æ§

**äº‹ä»¶ç±»å‹**: `EventTypeFileSystem` (å·²å®šä¹‰)

**åŠŸèƒ½æè¿°**:
- ç›‘æ§æ–‡ä»¶ç³»ç»Ÿå˜åŒ–
- æ£€æµ‹æ–‡ä»¶çš„åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ã€é‡å‘½å
- æ”¯æŒé€’å½’ç›‘æ§ç›®å½•

**å®ç°è¦ç‚¹**:
- ä½¿ç”¨ `fsnotify` æˆ–åŸç”Ÿ API
- é€’å½’ç›‘æ§ç›®å½•
- è¿‡æ»¤ç³»ç»Ÿæ–‡ä»¶å’Œä¸´æ—¶æ–‡ä»¶
- æ”¯æŒè·¯å¾„ç™½åå•/é»‘åå•

**é¢„è®¡å®ç°é˜¶æ®µ**: Phase 4ï¼ˆæ•°æ®æŒä¹…åŒ–é˜¶æ®µï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### Phase 2 å‰çš„å‡†å¤‡

**åº”ç”¨åˆ‡æ¢ç›‘æ§**:
- [ ] å®ç° ApplicationMonitor ç›‘æ§å™¨
- [ ] å®ç° AppTracker åº”ç”¨ä¼šè¯è¿½è¸ª
- [ ] å‘å¸ƒ `EventTypeAppSwitch` å’Œ `EventTypeAppSession` äº‹ä»¶
- [ ] æ·»åŠ åº”ç”¨ä½¿ç”¨æ—¶é•¿ç»Ÿè®¡

**æƒé™ç®¡ç†ç³»ç»Ÿ**:
- [ ] å®ç° CheckAccessibilityPermission
- [ ] æ·»åŠ æƒé™ç¼ºå¤±æ—¶çš„ç”¨æˆ·æç¤º
- [ ] æä¾›æ‰“å¼€ç³»ç»Ÿè®¾ç½®çš„å¿«æ·æ–¹å¼
- [ ] åœ¨ç›‘æ§å™¨å¯åŠ¨å‰éªŒè¯æƒé™

**äº‹ä»¶æŒä¹…åŒ–**:
- [ ] é›†æˆ SQLite å­˜å‚¨å±‚
- [ ] å®ç°æ‰¹é‡å†™å…¥ä¼˜åŒ–
- [ ] æ·»åŠ äº‹ä»¶æŸ¥è¯¢æ¥å£

**æ€§èƒ½ä¼˜åŒ–**:
- [ ] å‡å°‘ API è°ƒç”¨é¢‘ç‡
- [ ] ä¼˜åŒ–å†…å­˜ä½¿ç”¨
- [ ] å¼‚æ­¥å¤„ç†ä¼˜åŒ–

**é”™è¯¯å¤„ç†å¢å¼º**:
- [ ] ç›‘æ§å™¨è‡ªåŠ¨æ¢å¤
- [ ] è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- [ ] ä¼˜é›…å…³é—­æœºåˆ¶

### ç›¸å…³æ–‡æ¡£é“¾æ¥

- [ç³»ç»Ÿæ¶æ„](../architecture/00-system-architecture.md)
- [ç›‘æ§å¼•æ“è¯¦è§£](../architecture/02-monitor-engine.md)
- [Phase 2: æ¨¡å¼è¯†åˆ«](./03-phase2-patterns.md)

---

**æœ€åæ›´æ–°**: 2026-01-30
