# FlowMind é¡¹ç›®6ä¸ªé˜¶æ®µä¸²è”åˆ†æ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£åˆ†æ FlowMind é¡¹ç›®ä¸­6ä¸ªæ ¸å¿ƒé˜¶æ®µå¦‚ä½•é€šè¿‡**äº‹ä»¶é©±åŠ¨æ¶æ„**ä¸²è”æˆä¸€ä¸ªå®Œæ•´çš„AIé©±åŠ¨å·¥ä½œæµæ™ºèƒ½ä½“ç³»ç»Ÿã€‚

---

## ğŸ¯ 6ä¸ªæ ¸å¿ƒé˜¶æ®µ

### Phase 1: åŸºç¡€ç›‘æ§ï¼ˆæ•°æ®é‡‡é›†å±‚ï¼‰
**ç›®æ ‡**: å»ºç«‹ç³»ç»Ÿç›‘æ§èƒ½åŠ›ï¼Œæ•è·ç”¨æˆ·è¡Œä¸ºæ•°æ®

**ä¸»è¦ç»„ä»¶**:
- ç›‘æ§å¼•æ“ (`internal/monitor/engine.go`)
- é”®ç›˜ç›‘æ§å™¨ (`internal/monitor/keyboard.go`)
- å‰ªè´´æ¿ç›‘æ§å™¨ (`internal/monitor/clipboard.go`)
- å¹³å°å±‚æŠ½è±¡ (`internal/platform/`)

**è¾“å‡º**: ç›‘æ§äº‹ä»¶ â†’ äº‹ä»¶æ€»çº¿

---

### Phase 2: æ¨¡å¼è¯†åˆ«å¼•æ“ï¼ˆæ™ºèƒ½åˆ†æå±‚ï¼‰
**ç›®æ ‡**: AIé©±åŠ¨çš„æ¨¡å¼è¯†åˆ«ï¼Œè‡ªåŠ¨å‘ç°é‡å¤æ“ä½œæ¨¡å¼

**ä¸»è¦ç»„ä»¶**:
- äº‹ä»¶å­˜å‚¨ (`internal/storage/event_repository.go`)
- ä¼šè¯åˆ’åˆ†å™¨ (`internal/analyzer/session.go`)
- æ¨¡å¼æŒ–æ˜å™¨ (`internal/analyzer/prefixspan.go`)
- AIè¿‡æ»¤å™¨ (`internal/ai/pattern_filter.go`)

**è¾“å‡º**: è‡ªåŠ¨åŒ–å»ºè®® â†’ ç”¨æˆ·ç•Œé¢

---

### Phase 3: AI åŠ©æ‰‹é¢æ¿ï¼ˆäº¤äº’å±‚ï¼‰
**ç›®æ ‡**: å…¨å±€å¿«æ·é”® + ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„æ™ºèƒ½åŠ©æ‰‹

**ä¸»è¦ç»„ä»¶**:
- å¿«æ·é”®ç®¡ç†å™¨ (`internal/monitor/hotkey.go`)
- AIé¢æ¿ç•Œé¢ (`frontend/src/components/AIPanel/`)
- ä¸Šä¸‹æ–‡è·å– (`internal/platform/context.go`)

**è¾“å‡º**: å®æ—¶AIå¯¹è¯ + ä»£ç æ³¨å…¥

---

### Phase 4: æ™ºèƒ½å‰ªè—ä¸çŸ¥è¯†å›¾è°±ï¼ˆçŸ¥è¯†ç®¡ç†å±‚ï¼‰
**ç›®æ ‡**: AIé©±åŠ¨çš„çŸ¥è¯†ç®¡ç†å’Œæ™ºèƒ½æ¨è

**ä¸»è¦ç»„ä»¶**:
- å‰ªè—æœåŠ¡ (`internal/services/clipping.go`)
- å‘é‡åŒ–å­˜å‚¨ (`internal/storage/vector.go`)
- çŸ¥è¯†å›¾è°± (`internal/domain/knowledge/`)

**è¾“å‡º**: è¯­ä¹‰æœç´¢ + çŸ¥è¯†æ¨è

---

### Phase 5: è‡ªåŠ¨åŒ–å¼•æ“ï¼ˆæ‰§è¡Œå±‚ï¼‰
**ç›®æ ‡**: è‡ªç„¶è¯­è¨€ â†’ è‡ªåŠ¨åŒ–è„šæœ¬

**ä¸»è¦ç»„ä»¶**:
- DSLè§£æå™¨ (`internal/automation/parser.go`)
- è„šæœ¬ç”Ÿæˆå™¨ (`internal/automation/generator.go`)
- æ²™ç®±æ‰§è¡Œå™¨ (`internal/automation/sandbox.go`)
- ä»»åŠ¡è°ƒåº¦å™¨ (`internal/automation/scheduler.go`)

**è¾“å‡º**: è‡ªåŠ¨åŒ–ä»»åŠ¡æ‰§è¡Œ

---

### Phase 6: å¯è§†åŒ–ä»ªè¡¨æ¿ï¼ˆæ´å¯Ÿå±‚ï¼‰
**ç›®æ ‡**: å·¥ä½œæµæ•°æ®å¯è§†åŒ–ï¼Œæä¾›æ´å¯Ÿ

**ä¸»è¦ç»„ä»¶**:
- æ•°æ®èšåˆæœåŠ¡ (`internal/services/analytics.go`)
- å›¾è¡¨ç”Ÿæˆå™¨ (`internal/services/visualization.go`)
- æ—¶é—´åˆ†å¸ƒåˆ†æ (`internal/domain/analytics/`)

**è¾“å‡º**: å¯è§†åŒ–å›¾è¡¨ + AIæ´å¯Ÿ

---

## ğŸ”— é˜¶æ®µé—´çš„ä¸²è”æœºåˆ¶

### 1. æ ¸å¿ƒè¿æ¥ï¼šäº‹ä»¶é©±åŠ¨æ¶æ„

**äº‹ä»¶æ€»çº¿** (`pkg/events/bus.go`) æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒè¿æ¥å™¨ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   EventBus                          â”‚
â”‚  â€¢ å‘å¸ƒ-è®¢é˜…æ¨¡å¼                                      â”‚
â”‚  â€¢ é€šé…ç¬¦è®¢é˜… ("*")                                   â”‚
â”‚  â€¢ ä¸­é—´ä»¶é“¾ï¼ˆæ—¥å¿—ã€æ¢å¤ã€é™æµï¼‰                          â”‚
â”‚  â€¢ å¼‚æ­¥å¤„ç†                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘                   â†“
    [å‘å¸ƒè€…]              [è®¢é˜…è€…]
         â”‚                   â”‚
    Phase 1              Phase 2, 3, 4, 5, 6
```

**å…³é”®ä»£ç ** (`pkg/events/bus.go:163-208`):
```go
// è®¢é˜…äº‹ä»¶
func (bus *EventBus) Subscribe(eventType string, handler EventHandler) string

// å‘å¸ƒäº‹ä»¶
func (bus *EventBus) Publish(eventType string, event Event) error
```

---

### 2. é˜¶æ®µé—´æ•°æ®æµè½¬

#### å®Œæ•´æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 1: åŸºç¡€ç›‘æ§                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é”®ç›˜ç›‘æ§ â”€â”                                                  â”‚
â”‚  å‰ªè´´æ¿ç›‘æ§ â”œâ”€â”€â†’ EventBus.Publish("keyboard", event)         â”‚
â”‚  åº”ç”¨åˆ‡æ¢ â”€â”˜                                                  â”‚
â”‚                â†“                                             â”‚
â”‚           äº‹ä»¶æ€»çº¿ (pkg/events/bus.go)                        â”‚
â”‚                â†“                                             â”‚
â”‚           è®¢é˜…è€…å¤„ç† (å¼‚æ­¥ goroutine)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚            â”‚              â”‚             â”‚
    â†“            â†“            â†“              â†“             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Phase 2: â”‚ â”‚Phase 3: â”‚ â”‚Phase 4:  â”‚ â”‚Phase 5:  â”‚ â”‚Phase 6:  â”‚
â”‚æ¨¡å¼è¯†åˆ« â”‚ â”‚AIåŠ©æ‰‹   â”‚ â”‚çŸ¥è¯†ç®¡ç†  â”‚ â”‚è‡ªåŠ¨åŒ–    â”‚ â”‚å¯è§†åŒ–    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚           â”‚            â”‚              â”‚             â”‚
     â†“           â†“            â†“              â†“             â†“
 [å­˜å‚¨]      [é¢æ¿]       [å‘é‡åŒ–]       [è„šæœ¬]        [å›¾è¡¨]
 [åˆ†æ]      [å¯¹è¯]       [æœç´¢]        [æ‰§è¡Œ]        [æ´å¯Ÿ]
 [å»ºè®®]      [æ³¨å…¥]       [æ¨è]        [è°ƒåº¦]        [æŠ¥å‘Š]
```

---

#### è¯¦ç»†æµè½¬è¿‡ç¨‹

**æ­¥éª¤1: ç›‘æ§å±‚æ•è·äº‹ä»¶**

```go
// internal/monitor/keyboard.go
func (km *KeyboardMonitor) handlePlatformEvent(event platform.KeyboardEvent) {
    // 1. è·å–åº”ç”¨ä¸Šä¸‹æ–‡
    context := km.contextMgr.GetContext()

    // 2. æ„é€ ä¸šåŠ¡äº‹ä»¶
    data := map[string]interface{}{
        "keycode":   event.KeyCode,
        "modifiers": event.Modifiers,
    }

    businessEvent := events.NewEvent(events.EventTypeKeyboard, data)
    businessEvent.WithContext(context)

    // 3. å‘å¸ƒåˆ°äº‹ä»¶æ€»çº¿
    km.eventBus.Publish(string(events.EventTypeKeyboard), *businessEvent)
}
```

**æ­¥éª¤2: å„é˜¶æ®µè®¢é˜…å¹¶å¤„ç†äº‹ä»¶**

```go
// Phase 2: æ¨¡å¼è¯†åˆ« - è®¢é˜…æ‰€æœ‰äº‹ä»¶å¹¶æŒä¹…åŒ–
func (e *AnalyzerEngine) Start(eventBus *events.EventBus) error {
    eventBus.Subscribe("*", func(event events.Event) error {
        e.eventChan <- event  // å‘é€åˆ°åˆ†æé€šé“
        return nil
    })

    // å¯åŠ¨äº‹ä»¶å¤„ç†å¾ªç¯
    go e.processEvents()
}

// Phase 3: AIåŠ©æ‰‹ - è®¢é˜…å¿«æ·é”®äº‹ä»¶
func (p *AIPanel) Start(eventBus *events.EventBus) error {
    eventBus.Subscribe(events.EventTypeKeyboard, func(event events.Event) error {
        if p.isHotkeyMatch(event) {
            p.showPanel()  // æ˜¾ç¤ºAIé¢æ¿
        }
        return nil
    })
}

// Phase 4: çŸ¥è¯†ç®¡ç† - è®¢é˜…å‰ªè´´æ¿äº‹ä»¶
func (km *KnowledgeManager) Start(eventBus *events.EventBus) error {
    eventBus.Subscribe(events.EventTypeClipboard, func(event events.Event) error {
        if km.isClippingHotkey(event) {
            km.saveClipping(event)  // ä¿å­˜å‰ªè—å†…å®¹
        }
        return nil
    })
}

// Phase 5: è‡ªåŠ¨åŒ– - è®¢é˜…æ¨¡å¼å‘ç°äº‹ä»¶
func (ae *AutomationEngine) Start(eventBus *events.EventBus) error {
    eventBus.Subscribe("pattern:discovered", func(event events.Event) error {
        ae.generateAutomation(event)  // ç”Ÿæˆè‡ªåŠ¨åŒ–è„šæœ¬
        return nil
    })
}

// Phase 6: å¯è§†åŒ– - è®¢é˜…æ‰€æœ‰äº‹ä»¶ç”¨äºç»Ÿè®¡åˆ†æ
func (v *Visualizer) Start(eventBus *events.EventBus) error {
    eventBus.Subscribe("*", func(event events.Event) error {
        v.aggregateEvent(event)  // èšåˆæ•°æ®
        return nil
    })
}
```

---

### 3. å±‚çº§æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           React 19 å‰ç«¯å±‚ (Frontend)                â”‚
â”‚  â€¢ AIé¢æ¿                                          â”‚
â”‚  â€¢ çŸ¥è¯†å›¾è°±                                         â”‚
â”‚  â€¢ å¯è§†åŒ–ä»ªè¡¨æ¿                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ Wails Bindings
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            App å±‚ (internal/app/)                   â”‚
â”‚  â€¢ æ–¹æ³•å¯¼å‡º (å‰ç«¯å¯è°ƒç”¨)                             â”‚
â”‚  â€¢ äº‹ä»¶è½¬å‘ (åç«¯ â†’ å‰ç«¯)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æœåŠ¡å±‚ (internal/services/)                â”‚
â”‚  â€¢ ä¸šåŠ¡æµç¨‹ç¼–æ’                                      â”‚
â”‚  â€¢ è·¨é¢†åŸŸåä½œ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é¢†åŸŸå±‚ (internal/domain/)                   â”‚
â”‚  â€¢ monitor (ç›‘æ§é¢†åŸŸ)                               â”‚
â”‚  â€¢ analyzer (åˆ†æé¢†åŸŸ)                              â”‚
â”‚  â€¢ ai (AIé¢†åŸŸ)                                      â”‚
â”‚  â€¢ automation (è‡ªåŠ¨åŒ–é¢†åŸŸ)                          â”‚
â”‚  â€¢ knowledge (çŸ¥è¯†ç®¡ç†é¢†åŸŸ)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      åŸºç¡€è®¾æ–½å±‚ (internal/infrastructure/)          â”‚
â”‚  â€¢ storage (å­˜å‚¨)                                   â”‚
â”‚  â€¢ platform (å¹³å°ç›¸å…³)                              â”‚
â”‚  â€¢ config (é…ç½®)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. å…³é”®è¿æ¥ç‚¹åˆ†æ

#### è¿æ¥ç‚¹1: ç›‘æ§ â†’ åˆ†æ

**æ–‡ä»¶**: `internal/monitor/engine.go:92-97`

```go
// ç›‘æ§å¼•æ“å¯åŠ¨åå‘å¸ƒçŠ¶æ€äº‹ä»¶
statusEvent := events.NewEvent(events.EventTypeStatus, map[string]interface{}{
    "status":   "started",
    "monitors": []string{"keyboard", "clipboard"},
})
e.eventBus.Publish(string(events.EventTypeStatus), *statusEvent)
```

**æµè½¬**:
1. ç›‘æ§å¼•æ“å¯åŠ¨
2. å‘å¸ƒ `status:started` äº‹ä»¶
3. åˆ†æå¼•æ“è®¢é˜…å¹¶å“åº”
4. å¼€å§‹è®°å½•å’Œåˆ†æäº‹ä»¶

---

#### è¿æ¥ç‚¹2: åˆ†æ â†’ AIåŠ©æ‰‹

**æ–‡ä»¶**: `internal/analyzer/engine.go` (è®¡åˆ’ä¸­)

```go
// å‘ç°æ¨¡å¼åå‘å¸ƒäº‹ä»¶
patternEvent := events.NewEvent("pattern:discovered", map[string]interface{}{
    "pattern": pattern,
    "confidence": pattern.Confidence,
})
e.eventBus.Publish("pattern:discovered", *patternEvent)
```

**æµè½¬**:
1. åˆ†æå¼•æ“å‘ç°é‡å¤æ¨¡å¼
2. å‘å¸ƒ `pattern:discovered` äº‹ä»¶
3. AIåŠ©æ‰‹è®¢é˜…å¹¶åœ¨é¢æ¿æ˜¾ç¤ºå»ºè®®
4. ç”¨æˆ·å¯ä»¥æ¥å—/æ‹’ç»å»ºè®®

---

#### è¿æ¥ç‚¹3: AIåŠ©æ‰‹ â†’ è‡ªåŠ¨åŒ–

**æ–‡ä»¶**: è®¡åˆ’ä¸­çš„å®ç°

```go
// ç”¨æˆ·æ¥å—å»ºè®®ååˆ›å»ºè‡ªåŠ¨åŒ–ä»»åŠ¡
automationEvent := events.NewEvent("automation:create", map[string]interface{}{
    "name": pattern.Name,
    "steps": pattern.SuggestedSteps,
})
e.eventBus.Publish("automation:create", *automationEvent)
```

**æµè½¬**:
1. ç”¨æˆ·åœ¨AIé¢æ¿æ¥å—å»ºè®®
2. å‘å¸ƒ `automation:create` äº‹ä»¶
3. è‡ªåŠ¨åŒ–å¼•æ“è®¢é˜…å¹¶ç”Ÿæˆè„šæœ¬
4. è°ƒåº¦å™¨æ‰§è¡Œä»»åŠ¡

---

#### è¿æ¥ç‚¹4: çŸ¥è¯†ç®¡ç† â† â†’ æ‰€æœ‰é˜¶æ®µ

**æ–‡ä»¶**: è®¡åˆ’ä¸­çš„å®ç°

```go
// çŸ¥è¯†ç®¡ç†æœåŠ¡è®¢é˜…æ‰€æœ‰äº‹ä»¶
eventBus.Subscribe("*", func(event events.Event) error {
    // æå–å…³é”®ä¿¡æ¯å¹¶å‘é‡åŒ–
    knowledge := km.ExtractKnowledge(event)
    km.Vectorize(knowledge)

    // ä¿å­˜åˆ°å‘é‡æ•°æ®åº“
    km.Save(knowledge)
    return nil
})

// ä¸Šä¸‹æ–‡ç›¸å…³æ—¶æ¨é€çŸ¥è¯†
func (km *KnowledgeManager) Recommend(context EventContext) []Knowledge {
    // è¯­ä¹‰æœç´¢
    results := km.VectorSearch(context)
    return results
}
```

**æµè½¬**:
1. æ‰€æœ‰é˜¶æ®µçš„äº‹ä»¶éƒ½åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯
2. çŸ¥è¯†ç®¡ç†è®¢é˜…å¹¶å‘é‡åŒ–å­˜å‚¨
3. ç”¨æˆ·æ“ä½œæ—¶è¿›è¡Œè¯­ä¹‰æœç´¢
4. æ™ºèƒ½æ¨èç›¸å…³çŸ¥è¯†

---

#### è¿æ¥ç‚¹5: æ‰€æœ‰é˜¶æ®µ â†’ å¯è§†åŒ–

**æ–‡ä»¶**: è®¡åˆ’ä¸­çš„å®ç°

```go
// å¯è§†åŒ–æœåŠ¡è®¢é˜…æ‰€æœ‰äº‹ä»¶ç”¨äºç»Ÿè®¡åˆ†æ
eventBus.Subscribe("*", func(event events.Event) error {
    // èšåˆç»Ÿè®¡
    v.Aggregate(event)

    // å®æ—¶æ›´æ–°å›¾è¡¨
    if v.ShouldUpdate() {
        v.UpdateCharts()
    }
    return nil
})
```

**æµè½¬**:
1. æ‰€æœ‰é˜¶æ®µçš„äº‹ä»¶éƒ½æµå…¥å¯è§†åŒ–æœåŠ¡
2. å®æ—¶èšåˆç»Ÿè®¡æ•°æ®
3. ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
4. AIç”Ÿæˆæ´å¯ŸæŠ¥å‘Š

---

## ğŸ”„ äº‹ä»¶ç”Ÿå‘½å‘¨æœŸç¤ºä¾‹

### å®Œæ•´æµç¨‹ï¼šç”¨æˆ·æŒ‰é”® â†’ è‡ªåŠ¨åŒ–å»ºè®®

```
1. ç”¨æˆ·æŒ‰ä¸‹ Cmd+C (å¤åˆ¶)
   â†“
2. macOS CGEventTap æ•è·äº‹ä»¶
   â†“
3. å¹³å°å±‚è½¬æ¢ä¸º KeyboardEvent
   â†“
4. ä¸šåŠ¡å±‚æ·»åŠ ä¸Šä¸‹æ–‡ (VS Code)
   â†“
5. å‘å¸ƒ "keyboard" äº‹ä»¶åˆ°æ€»çº¿
   â†“
6. å¿«æ·é”®ç®¡ç†å™¨åŒ¹é…å¹¶è§¦å‘å›è°ƒ
   â†“
7. å‰ªè´´æ¿ç›‘æ§å™¨æ£€æµ‹åˆ°å†…å®¹å˜åŒ–
   â†“
8. å‘å¸ƒ "clipboard" äº‹ä»¶
   â†“
9. åˆ†æå¼•æ“è®°å½•äº‹ä»¶åºåˆ—
   â†“
10. æ¨¡å¼æŒ–æ˜å™¨è¯†åˆ«é¢‘ç¹åºåˆ—
   â†“
11. å‘å¸ƒ "pattern:discovered" äº‹ä»¶
   â†“
12. AIè¿‡æ»¤å™¨åˆ†ææ¨¡å¼ä»·å€¼
   â†“
13. AIé¢æ¿æ˜¾ç¤ºè‡ªåŠ¨åŒ–å»ºè®®
   â†“
14. ç”¨æˆ·æ¥å—å»ºè®®
   â†“
15. å‘å¸ƒ "automation:create" äº‹ä»¶
   â†“
16. è‡ªåŠ¨åŒ–å¼•æ“ç”Ÿæˆè„šæœ¬
   â†“
17. è°ƒåº¦å™¨æ‰§è¡Œä»»åŠ¡
   â†“
18. å¯è§†åŒ–ä»ªè¡¨æ¿æ›´æ–°ç»Ÿè®¡
```

---

## ğŸ“Š é˜¶æ®µé—´ä¾èµ–å…³ç³»

### ä¾èµ–å›¾

```
Phase 1: åŸºç¡€ç›‘æ§
   â†“ å¿…éœ€
Phase 2: æ¨¡å¼è¯†åˆ«
   â†“ å¯é€‰
Phase 3: AIåŠ©æ‰‹ â”€â”€â”
   â†“ å¯é€‰          â”‚
Phase 4: çŸ¥è¯†ç®¡ç† â†â”¤ å¹³è¡Œä¾èµ–
   â†“ å¯é€‰          â”‚
Phase 5: è‡ªåŠ¨åŒ– â”€â”€â”˜
   â†“ å¯é€‰
Phase 6: å¯è§†åŒ–
```

### ä¾èµ–è¯´æ˜

| é˜¶æ®µ | å‰ç½®ä¾èµ– | æ•°æ®è¾“å…¥ | æ•°æ®è¾“å‡º |
|------|---------|---------|---------|
| Phase 1 | æ—  | ç³»ç»Ÿäº‹ä»¶ | ç›‘æ§äº‹ä»¶ |
| Phase 2 | Phase 1 | ç›‘æ§äº‹ä»¶ | æ¨¡å¼å»ºè®® |
| Phase 3 | Phase 1 | ä¸Šä¸‹æ–‡äº‹ä»¶ | AIå“åº” |
| Phase 4 | Phase 1 | æ‰€æœ‰äº‹ä»¶ | çŸ¥è¯†æ¨è |
| Phase 5 | Phase 1,2 | æ¨¡å¼å»ºè®® | æ‰§è¡Œç»“æœ |
| Phase 6 | Phase 1-5 | æ‰€æœ‰äº‹ä»¶ | å¯è§†åŒ–æ•°æ® |

---

## ğŸ¯ æ¶æ„ä¼˜åŠ¿

### 1. æ¾è€¦åˆè®¾è®¡
- å„é˜¶æ®µé€šè¿‡äº‹ä»¶é€šä¿¡ï¼Œäº’ä¸ç›´æ¥ä¾èµ–
- æ˜“äºæ·»åŠ /ç§»é™¤é˜¶æ®µ
- ä¾¿äºç‹¬ç«‹æµ‹è¯•å’Œå¼€å‘

### 2. é«˜å¯æ‰©å±•æ€§
- æ–°å¢é˜¶æ®µåªéœ€è®¢é˜…ç›¸å…³äº‹ä»¶
- æ”¯æŒå¤šä¸ªé˜¶æ®µå¹¶è¡Œå¤„ç†åŒä¸€äº‹ä»¶
- ä¸­é—´ä»¶æœºåˆ¶æä¾›ç»Ÿä¸€çš„æ¨ªåˆ‡å…³æ³¨ç‚¹

### 3. å®æ—¶å“åº”
- å¼‚æ­¥äº‹ä»¶å¤„ç†ä¿è¯é«˜ååé‡
- goroutine å¹¶å‘å¤„ç†æå‡æ€§èƒ½
- ç¼“å†²æœºåˆ¶é˜²æ­¢é˜»å¡

### 4. æ•°æ®ä¸€è‡´æ€§
- äº‹ä»¶æ€»çº¿ä¿è¯äº‹ä»¶é¡ºåº
- ç»Ÿä¸€çš„äº‹ä»¶ç»“æ„
- ä¸Šä¸‹æ–‡ä¿¡æ¯è‡ªåŠ¨ä¼ é€’

---

## ğŸ”§ å…³é”®æŠ€æœ¯ç‚¹

### 1. äº‹ä»¶æ€»çº¿è®¾è®¡

**æ–‡ä»¶**: `pkg/events/bus.go`

**ç‰¹æ€§**:
- å‘å¸ƒ-è®¢é˜…æ¨¡å¼
- é€šé…ç¬¦è®¢é˜…
- ä¸­é—´ä»¶é“¾ï¼ˆæ¢å¤ã€æ—¥å¿—ã€é™æµï¼‰
- å¼‚æ­¥å¤„ç†
- ä¼˜é›…å…³é—­

### 2. ä¸Šä¸‹æ–‡å¢å¼º

**æ–‡ä»¶**: `pkg/events/event.go`

**EventContext ç»“æ„**:
```go
type EventContext struct {
    Application string  // å½“å‰æ´»åŠ¨åº”ç”¨
    BundleID    string  // åº”ç”¨ Bundle ID
    WindowTitle string  // çª—å£æ ‡é¢˜
    FilePath    string  // ç›¸å…³æ–‡ä»¶è·¯å¾„
    Selection   string  // é€‰ä¸­æ–‡æœ¬
}
```

### 3. æ‰¹é‡å†™å…¥ä¼˜åŒ–

**æ–‡ä»¶**: `internal/storage/batch_writer.go` (è®¡åˆ’ä¸­)

**ç­–ç•¥**:
- ç¼“å†²åŒºå¤§å°ï¼š100æ¡äº‹ä»¶
- å®šæ—¶åˆ·æ–°ï¼š5ç§’
- å¼‚æ­¥å†™å…¥ï¼šä¸é˜»å¡äº‹ä»¶æµ

### 4. ä¼šè¯åˆ’åˆ†ç®—æ³•

**æ–‡ä»¶**: `internal/analyzer/session.go` (è®¡åˆ’ä¸­)

**è§„åˆ™**:
- æ—¶é—´çª—å£ï¼š10åˆ†é’Ÿæ— æ“ä½œåˆ™ç»“æŸä¼šè¯
- åº”ç”¨åˆ‡æ¢ï¼šåˆ‡æ¢åº”ç”¨åˆ™ç»“æŸå½“å‰ä¼šè¯
- æœ€å°äº‹ä»¶æ•°ï¼šè‡³å°‘5ä¸ªäº‹ä»¶æ‰æ„æˆæœ‰æ•ˆä¼šè¯

---

## ğŸ“ å®ç°è¿›åº¦

### å½“å‰çŠ¶æ€

| é˜¶æ®µ | çŠ¶æ€ | å®Œæˆåº¦ | å¤‡æ³¨ |
|------|------|-------|------|
| Phase 1 | ğŸš§ è¿›è¡Œä¸­ | 60% | é”®ç›˜ç›‘æ§å·²å®Œæˆï¼Œå‰ªè´´æ¿ç›‘æ§è¿›è¡Œä¸­ |
| Phase 2 | ğŸ“‹ è®¾è®¡ä¸­ | 0% | è¯¦ç»†è®¾è®¡æ–‡æ¡£å·²å®Œæˆ |
| Phase 3 | ğŸ“‹ è®¾è®¡ä¸­ | 0% | åŠŸèƒ½è§„åˆ’å®Œæˆ |
| Phase 4 | ğŸ“‹ è§„åˆ’ä¸­ | 0% | æŠ€æœ¯é€‰å‹è¿›è¡Œä¸­ |
| Phase 5 | ğŸ“‹ è§„åˆ’ä¸­ | 0% | æ¦‚å¿µè®¾è®¡å®Œæˆ |
| Phase 6 | ğŸ“‹ è§„åˆ’ä¸­ | 0% | åŸå‹è®¾è®¡é˜¶æ®µ |

### å½“å‰åˆ†æ”¯
- `feature/monitor-engine` - Phase 1 å®ç°åˆ†æ”¯

---

## âœ… éªŒè¯æ£€æŸ¥æ¸…å•

### é˜¶æ®µä¸²è”éªŒè¯

- [ ] **äº‹ä»¶æµéªŒè¯**
  - [ ] ç›‘æ§äº‹ä»¶èƒ½æ­£ç¡®å‘å¸ƒåˆ°äº‹ä»¶æ€»çº¿
  - [ ] å„é˜¶æ®µèƒ½æ­£ç¡®è®¢é˜…å¹¶å¤„ç†äº‹ä»¶
  - [ ] äº‹ä»¶é¡ºåºå¾—åˆ°ä¿è¯

- [ ] **æ•°æ®å®Œæ•´æ€§**
  - [ ] ä¸Šä¸‹æ–‡ä¿¡æ¯æ­£ç¡®ä¼ é€’
  - [ ] äº‹ä»¶æ•°æ®ä¸ä¸¢å¤±
  - [ ] å¼‚å¸¸æƒ…å†µå¾—åˆ°å¤„ç†

- [ ] **æ€§èƒ½æŒ‡æ ‡**
  - [ ] äº‹ä»¶ååé‡ > 1000 events/sec
  - [ ] äº‹ä»¶å»¶è¿Ÿ < 100ms
  - [ ] å†…å­˜å ç”¨åˆç†

- [ ] **é›†æˆæµ‹è¯•**
  - [ ] Phase 1 â†’ Phase 2 æµç¨‹éªŒè¯
  - [ ] Phase 2 â†’ Phase 3 æµç¨‹éªŒè¯
  - [ ] Phase 2 â†’ Phase 5 æµç¨‹éªŒè¯
  - [ ] æ‰€æœ‰é˜¶æ®µ â†’ Phase 6 æµç¨‹éªŒè¯

---

## ğŸ“ æ€»ç»“

FlowMind é¡¹ç›®é€šè¿‡**äº‹ä»¶é©±åŠ¨æ¶æ„**å°†6ä¸ªæ ¸å¿ƒé˜¶æ®µä¸²è”æˆä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿï¼š

1. **äº‹ä»¶æ€»çº¿**æ˜¯æ ¸å¿ƒè¿æ¥å™¨ï¼Œå®ç°æ¾è€¦åˆçš„é€šä¿¡
2. **åˆ†å±‚æ¶æ„**æä¾›æ¸…æ™°çš„èŒè´£åˆ’åˆ†
3. **å¼‚æ­¥å¤„ç†**ä¿è¯é«˜æ€§èƒ½å’Œå®æ—¶å“åº”
4. **ä¸Šä¸‹æ–‡å¢å¼º**ä¸ºAIåŠŸèƒ½æä¾›ä¸°å¯Œä¿¡æ¯
5. **ä¸­é—´ä»¶æœºåˆ¶**æä¾›ç»Ÿä¸€çš„æ¨ªåˆ‡å…³æ³¨ç‚¹

è¿™ç§è®¾è®¡ä½¿å¾—ç³»ç»Ÿå…·æœ‰é«˜å¯æ‰©å±•æ€§ã€é«˜å¯ç»´æŠ¤æ€§ï¼Œå¹¶ä¸”ä¾¿äºå¢é‡å¼€å‘å’Œæµ‹è¯•ã€‚

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2026-01-30
**æœ€åæ›´æ–°**: 2026-01-30
